<!doctype html>
<html lang="en" ng-app="myApp">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Price Profor Engine: ReportDay</title>
        <link id="data-uikit-theme" rel="stylesheet" href="/vendor/uikit/css/uikit.css">
        <link id="data-uikit-theme" rel="stylesheet" href="/vendor/uikit/css/components/datepicker.css">
        <link id="data-uikit-theme" rel="stylesheet" href="/vendor/uikit/css/components/accordion.css">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.min.js"></script>
        <script src="/vendor/uikit/js/uikit.min.js"></script>
        <script src="/vendor/uikit/js/components/grid.js"></script>
        <script src="/vendor/uikit/js/components/datepicker.js"></script>
        <script src="/vendor/uikit/js/components/accordion.js"></script>
</head>
<body>
<div class="uk-container uk-container-center">
<form class="uk-form" ng-controller="FormController">
    <div class="uk-width-2-3 uk-container-center">
    <fieldset data-uk-margin="">
        <legend>Obtiene los datos del Mercado Diario de Electricidad del Operador de Mercado OMIE</legend>
        <input class="uk-button uk-margin-small-top" type="button" ng-click="generatefile(datafile)" value="Generar y descargar"/>
        <select ng-model="datafile.market" class="uk-margin-small-top">
            <option value="MI">MIBEL</option>
            <option value="ES">Componente Española</option>
            <option value="Portugal">Componente Portuguesa</option>
        </select>
        <input class="uk-margin-small-top" type="text" ng-model="datafile.fechaini" data-uk-datepicker="{format:'YYYY-MM-DD'}">
        <input class="uk-margin-small-top" type="text" ng-model="datafile.fechafin" data-uk-datepicker="{format:'YYYY-MM-DD'}">
    </fieldset>
    </div>
    <div class="uk-width-2-3 uk-container-center">
    <fieldset>
        <legend>Selecciona los campos del fichero de datos</legend>
        <div class="uk-accordion" data-uk-accordion="{showfirst:false}">
            <h3 class="uk-accordion-title">MIBEL</h3>
            <div class="uk-accordion-content">
                <input type="radio" id="form-s-r1" name="radio" ng-model="datafile.market">
            </div>
            <h3 class="uk-accordion-title">Componente Española</h3>
            <div class="uk-accordion-content">
                <input type="radio" id="form-s-r1" name="radio" ng-model="datafile.market">
            </div>
            <h3 class="uk-accordion-title">Componente Portuguesa</h3>
            <div class="uk-accordion-content">
                <input type="radio" id="form-s-r1" name="radio" ng-model="datafile.market">
            </div>
        </div>
    </fieldset>
    </div>
</form>
</div>

</body>
<script>
    var app = angular.module('myApp', []);
    // DataFileGenerator FormController!
    app.controller('FormController',
        
        function ($scope, $http) {
            // The predefined data:
            $scope.datafile = {'fechaini': "2014-1-1"};
            $scope.datafile.fechafin = "2014-12-31";
            $scope.datafile.market = "MI";
        // $scope.verver.fechaini = "2014-01-01";
        $scope.generatefile = function(datafile) {
        alert(JSON.stringify(datafile));
        
        $http.post('/omieinfosys/DataFileGenerator', datafile ).
        success(function(data, status, headers, config) {
            var file = new Blob([ data ], {
                type : 'application/csv'
            });
            //trick to download store a file having its URL
            var fileURL = URL.createObjectURL(file);
            var a         = document.createElement('a');
            a.href        = fileURL; 
            a.target      = '_blank';
            a.download    = 'omieinfodata.csv';
            document.body.appendChild(a);
            a.click();
        // alert(JSON.stringify(data));
        // alert(status);
        }).
        error(function(data, status, headers, config) {
        // called asynchronously if an error occurs
        // or server returns response with an error status.
        });
    };

  
}
        );
</script>
</html>